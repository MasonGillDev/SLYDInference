<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vLLM Configuration Portal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="topbar">
        <div class="nav-content">
            <div class="logo-section">
                <h1 style="color: white; margin: 0;">vLLM Configuration</h1>
            </div>
            <div class="nav-links">
                <a href="http://localhost:5002/docs" target="_blank" class="docs-link">API Docs</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">

        <!-- Model Configuration Section -->
        <div class="card">
            <h2 class="section-title">Model Configuration</h2>

            <div class="form-group">
                <label for="model-id">HuggingFace Model ID</label>
                <div class="input-with-button">
                    <input type="text"
                           id="model-id"
                           value="{{ vllm_config.model }}"
                           placeholder="e.g., HuggingFaceTB/SmolLM3-3B"
                           class="input-field flex-1">
                    <button type="button" class="btn-check" onclick="checkModel()">Check</button>
                </div>
                <div id="model-status" class="status-message"></div>
            </div>

        </div>

        <!-- Network Configuration Section -->
        <div class="card">
            <h2 class="section-title">Network Settings</h2>

            <div class="form-row">
                <div class="form-group">
                    <label for="host">Host</label>
                    <input type="text"
                           id="host"
                           value="{{ vllm_config.host }}"
                           class="input-field">
                    <small class="helper-text">Use 0.0.0.0 for all interfaces</small>
                </div>

                <div class="form-group">
                    <label for="port">Port</label>
                    <input type="number"
                           id="port"
                           value="{{ vllm_config.port }}"
                           min="1"
                           max="65535"
                           class="input-field">
                    <small class="helper-text">API server port (default: 5002)</small>
                </div>
            </div>
        </div>

        <!-- Performance Configuration Section -->
        <div class="card">
            <h2 class="section-title">Performance Settings</h2>

            <div class="form-row">
                <div class="form-group">
                    <label for="gpu-memory">GPU Memory Utilization</label>
                    <input type="number"
                           id="gpu-memory"
                           value="{{ vllm_config.gpu_memory_utilization }}"
                           step="0.05"
                           min="0.1"
                           max="1.0"
                           class="input-field">
                    <small class="helper-text">0.1 to 1.0 (default: 0.7)</small>
                </div>

                <div class="form-group">
                    <label for="max-model-len">Max Model Length</label>
                    <input type="number"
                           id="max-model-len"
                           value="{{ vllm_config.max_model_len }}"
                           min="128"
                           max="131072"
                           class="input-field">
                    <small class="helper-text">Maximum context length (default: 8192)</small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="max-num-seqs">Max Number of Sequences</label>
                    <input type="number"
                           id="max-num-seqs"
                           value="{{ vllm_config.max_num_seqs }}"
                           min="1"
                           max="256"
                           class="input-field">
                    <small class="helper-text">Concurrent requests (default: 32)</small>
                </div>

                <div class="form-group">
                    <label for="tensor-parallel">Tensor Parallel Size</label>
                    <input type="number"
                           id="tensor-parallel"
                           value="{{ vllm_config.tensor_parallel_size }}"
                           min="1"
                           max="8"
                           class="input-field">
                    <small class="helper-text">Number of GPUs to use (default: 1)</small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="dtype">Data Type</label>
                    <select id="dtype" class="input-field">
                        <option value="auto" {% if vllm_config.dtype == 'auto' %}selected{% endif %}>auto</option>
                        <option value="float16" {% if vllm_config.dtype == 'float16' %}selected{% endif %}>float16</option>
                        <option value="bfloat16" {% if vllm_config.dtype == 'bfloat16' %}selected{% endif %}>bfloat16</option>
                        <option value="float32" {% if vllm_config.dtype == 'float32' %}selected{% endif %}>float32</option>
                    </select>
                    <small class="helper-text">Model precision (default: auto)</small>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox"
                               id="trust-remote-code"
                               {% if vllm_config.trust_remote_code %}checked{% endif %}>
                        <span>Trust Remote Code</span>
                    </label>
                    <small class="helper-text">Allow custom model code</small>
                </div>
            </div>
        </div>

        <!-- Service Status Card -->
        <div class="card">
            <h2 class="section-title">Service Status</h2>
            <div id="service-info">
                <button type="button" class="btn-secondary" onclick="checkServiceStatus()">Check Status</button>
            </div>
            <div id="service-status" class="status-message" style="margin-top: 1rem;"></div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button type="button" class="btn-primary" onclick="saveConfig()">Save Configuration</button>
            <button type="button" class="btn-secondary" onclick="resetToDefaults()">Reset to Defaults</button>
            <button type="button" class="btn-secondary" onclick="restartService()">Restart Service</button>
        </div>

        <!-- Raw JSON Editor Toggle -->
        <div style="margin-top: 1.5rem; text-align: center;">
            <button type="button" class="btn-toggle" onclick="toggleRawEditor()">
                <span id="toggle-text">Show Raw JSON Editor</span>
            </button>
        </div>

        <!-- Raw JSON Editor (Hidden by default) -->
        <div id="raw-editor" class="raw-editor-container" style="display: none;">
            <div class="card">
                <h2 class="section-title">Raw Configuration Editor</h2>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
                    ⚠️ Advanced: Edit the raw JSON configuration directly.
                </p>
                <textarea id="raw-config-textarea" class="raw-config-textarea" rows="15">{{ vllm_config | tojson(indent=2) }}</textarea>
                <div class="raw-editor-buttons">
                    <button type="button" class="btn-primary" onclick="saveRawConfig()">Save Raw Config</button>
                    <button type="button" class="btn-secondary" onclick="cancelRawEdit()">Cancel</button>
                </div>
                <div id="raw-editor-status" class="status-message"></div>
            </div>
        </div>

        <!-- API Endpoints Info -->
        <div class="card" style="margin-top: 2rem;">
            <h2 class="section-title">API Endpoints</h2>
            <div style="font-family: monospace; background: #f5f5f5; padding: 1rem; border-radius: 4px;">
                <p style="margin: 0.5rem 0;"><strong>Base URL:</strong> http://{{ request.host.split(':')[0] }}:{{ vllm_config.port }}</p>
                <p style="margin: 0.5rem 0;"><strong>Models:</strong> GET /v1/models</p>
                <p style="margin: 0.5rem 0;"><strong>Completions:</strong> POST /v1/completions</p>
                <p style="margin: 0.5rem 0;"><strong>Chat:</strong> POST /v1/chat/completions</p>
            </div>
        </div>
    </div>

    <script>
        // Set API base URL for fetch requests
        window.API_BASE = "{{ request.script_root }}";
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>